# 분석 대시보드 테스트 시나리오

현재 날짜: 2026-01-06 (KST 기준)

## 공통 사전조건
- DB 세션 타임존이 `+09:00`로 고정되는지 확인(앱 부트스트랩에서 `SET time_zone = '+09:00'`).
- 대시보드는 발주일(`purchase_orders.order_date`)을 기간 필터 기준으로 집계.
- 입고수량은 `receipts.purchase_order_id` + `receipt_items.item_id`로 매칭해 합산.

## 1) 관리자(admin) 로그인

### 1-1. 전체 거래처 TOP
1. 관리자 계정으로 로그인
2. 사이드바에서 “분석 대시보드” 이동
3. 기본 기간이 최근 30일(`?range=30d`)인지 확인
4. KPI 4개가 전체 거래처 기준으로 표출되는지 확인
5. 막대 그래프가 “거래처별 입고율 TOP”으로 표시되는지 확인

### 1-2. 드릴다운 정상
- 도넛 차트에서
  - “입고완료” 클릭 → URL에 `status=complete`가 붙고, 하단 리스트가 입고완료 라인만 보여야 함
  - “부분입고” 클릭 → `status=partial`
  - “미입고/지연” 클릭 → `status=none`
- 막대 차트에서
  - 특정 거래처 막대 클릭 → URL에 `supplier_id=<id>`가 반영되고 KPI/그래프/리스트가 해당 거래처로 집계/필터링
- “전체 보기” 버튼 클릭 → `status`/`item_id`가 제거되고 리스트가 기본(잔량>0)으로 복귀

### 1-3. 기간 변경 연동
- 기간 드롭다운을
  - 최근 7일 / 이번달 / 지난달로 변경
- KPI/도넛/막대/리스트가 모두 해당 기간으로 연동되는지 확인

## 2) 거래처(vendor/supplier) 로그인

### 2-1. 본인 데이터만 노출(권한 우회 방지)
1. 거래처 계정으로 로그인
2. 대시보드 접속
3. URL에 임의로 `supplier_id=다른거래처ID`를 넣어도 결과가 바뀌지 않고, 항상 본인 거래처 데이터만 보이는지 확인

### 2-2. 품목 TOP + 드릴다운
1. 막대 그래프 제목이 “내 발주 품목 TOP”인지 확인
2. 막대 클릭 시 URL에 `item_id=<id>`가 붙고 하단 리스트가 해당 품목으로만 필터링되는지 확인
3. 도넛 클릭 시 `status`가 붙고 하단 리스트가 상태별로 필터링되는지 확인

### 2-3. 기간 변경 연동
- 기간을 변경하면 KPI/도넛/막대/리스트가 모두 변경되는지 확인

## 3) 데이터 정의 점검
- 입고율(%) = (누적 입고수량 / 발주수량) * 100
- 라인 상태(라인 기준)
  - complete: 입고수량 >= 발주수량
  - partial: 0 < 입고수량 < 발주수량
  - none: 입고수량 = 0

## 참고
- 납기 컬럼이 별도로 없어서, 리스트의 “납기”는 발주일(`order_date`)로 표기됩니다.
